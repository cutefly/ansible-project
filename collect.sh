#!/bin/sh
HOSTNAME=`hostname`
DATE=`date -I`
#FILENAME=$HOSTNAME-$DATE.txt
FILENAME=result.txt

#LANG=C
#export LANG

echo ========= KPC Linux System / Security Check is Start =========
echo

echo [ Checking 1/20 ]
echo "=========================================================================================================="
echo " 시스템 설치일                                                                                            "
echo "=========================================================================================================="
echo " [CentOS]"                                                                                                 
ls -l --time-style full-iso /root/anaconda-ks.cfg                                                                
echo
echo " [Ubuntu]"                                                                                                 
ls -l --time-style full-iso /var/log/installer/syslog                                                            
echo

echo [ Checking 2/20 ]
echo "=========================================================================================================="
echo " 시스템 부트일                                                                                            "
echo "=========================================================================================================="
who -b                                                                                                           
echo

echo [ Checking 3/20 ]
echo "=========================================================================================================="
echo " 시스템 가동일                                                                                            "
echo "=========================================================================================================="
uptime                                                                                                           
echo

echo [ Checking 4/20 ]
echo "=========================================================================================================="
echo " 날짜/시간                                                                                                "
echo "=========================================================================================================="
echo " ■ 시간 설정 정보                                                                                         "
cat /etc/ntp.conf | grep server                                                                                  
echo
echo " ■ NTP 서버와 시간차                                                                                      "
/usr/sbin/ntpq -p                                                                                                          
echo

echo [ Checking 5/20 ]
echo "=========================================================================================================="
echo " CPU, 메모리 사용률 확인                                                                                  "
echo "=========================================================================================================="
echo " ■ Physical 메모리 정보                                                                                   "
vmstat -s -S M                                                                                                   
echo
echo " ■ 20초 동안 CPU 사용률                                                                                   "
vmstat -S M 2 20                                                                                                 
echo

echo [ Checking 6/20 ]
echo "=========================================================================================================="
echo " 디스크 사용률 확인                                                                                       "
echo "=========================================================================================================="
lsblk                                                                                                            
echo
df -hP                                                                                                           
echo

echo [ Checking 7/20 ]
echo "=========================================================================================================="
echo " root 계정 ssh 직접 접속 가능 여부 확인                                                                   "
echo "=========================================================================================================="
cat /etc/ssh/sshd_config | grep "PermitRootLogin"                                                                
echo

echo [ Checking 8/20 ]
echo "=========================================================================================================="
echo " 불필요한 계정 존재 여부 확인                                                                             "
echo "=========================================================================================================="
echo " ■ Shell 로그인 가능 계정                                                                                 "
cat /etc/passwd | grep /bin/bash                                                                                 
echo
echo " ■ Lastlog                                                                                                "
lastlog                                                                                                          
echo

echo [ Checking 9/20 ]
echo "=========================================================================================================="
echo " 계정 잠금 임계값 확인                                                                                    "
echo "=========================================================================================================="
echo " [CentOS]"                                                                                                 
echo "/etc/pam.d/system-auth"                                                                                    
cat /etc/pam.d/system-auth | grep "deny="                                                                        
echo "/etc/pam.d/password-auth"                                                                                  
cat /etc/pam.d/password-auth | grep "deny="                                                                      
echo
echo " [Ubuntu]"                                                                                                 
cat /etc/pam.d/common-auth | grep "deny="                                                                        
echo

echo [ Checking 10/20 ]
echo "=========================================================================================================="
echo " 관리자 그룹 계정 확인                                                                                    "
echo "=========================================================================================================="
cat /etc/group                                                                                                   
echo

echo [ Checking 11/20 ]
echo "=========================================================================================================="
echo " 관리자 계정 암호 변경일 확인                                                                             "
echo "=========================================================================================================="
chage -l root                                                                                                    
echo

echo [ Checking 12/20 ]
echo "=========================================================================================================="
echo " OS 방화벽 사용 여부 확인                                                                                 "
echo "=========================================================================================================="
echo " [CentOS]"                                                                                                 
service iptables status                                                                                          
systemctl status firewalld.service                                                                               
echo

echo " [Ubuntu]"                                                                                                 
ufw status verbose                                                                                               
echo

echo [ Checking 13/20 ]
echo "=========================================================================================================="
echo " 접속 IP 및 포트 제한 확인                                                                                "
echo "=========================================================================================================="
echo " [CentOS]"                                                                                                 
cat /etc/sysconfig/iptables                                                                                                                                                                                  
firewall-cmd --list-all                                                                                          
echo

echo " [Ubuntu]"                                                                                                 
ufw app list                                                                                                     
echo

echo [ Checking 14/20 ]
echo "=========================================================================================================="
echo " Session Timeout 설정 확인                                                                                "
echo "=========================================================================================================="
cat /etc/profile | grep TMOUT                                                                                    
echo

echo [ Checking 15/20 ]
echo "=========================================================================================================="
echo " DNS 서버 확인                                                                                            "
echo "=========================================================================================================="
cat /etc/resolv.conf                                                                                             
echo

echo [ Checking 16/20  ]
echo "=========================================================================================================="
echo " LISTEN 포트 확인                                                                                         "
echo "=========================================================================================================="
netstat -anp | grep "LISTEN"                                                                                     
echo

echo [ Checking 17/20 ]
echo "=========================================================================================================="
echo " 실행중인 서비스 확인                                                                                     "
echo "=========================================================================================================="
pstree -apu                                                                                                      
echo
ps -ef                                                                                                           
echo

echo [ Checking 18/20 ]
echo "=========================================================================================================="
echo " 시스템 로그 확인                                                                                         "
echo "=========================================================================================================="
dmesg | tail                                                                                                     
echo

echo [ Checking 19/20 ]
echo "=========================================================================================================="
echo " NAS 연결 유무 확인                                                                                       "
echo "=========================================================================================================="
df -h                                                                                                            
cat /etc/fstab                                                                                                   
echo

echo [ Checking 20/20 ]
echo "=========================================================================================================="
echo " 점검일자                                                                                                 "
echo "=========================================================================================================="
date                                                                                                             
echo

echo ========= KPC Linux System / Security Check is End =========
