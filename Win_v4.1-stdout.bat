@echo off
pushd %~dp0
:: 명령 프롬프트 위치를 배치파일이 있는 디렉토리로 설정

TITLE KPC WINDOWS SYSTEM / SECURITY CHECK

::영문으로 변경
::chcp 949

cls

echo ========= KPC Windows System / Security Check is Start =========
echo.

echo [ Checking 1/15 ]
echo ==========================================================================================================
echo  시스템 설치일                                                                                            
echo ==========================================================================================================
systeminfo | find "Install Date"                                                                               
echo.

echo [ Checking 2/15 ]
echo ==========================================================================================================
echo  시스템 부트일                                                                                            
echo ==========================================================================================================
net stats work | find "since"                                                                                  
echo.

echo ==========================================================================================================
echo  시스템 가동일                                                                                            
echo ==========================================================================================================
echo  ※ 엑셀 자동계산                                                                                         
echo.

echo [ Checking 3/15 ]
echo ==========================================================================================================
echo  날짜/시간                                                                                                
echo ==========================================================================================================
echo  ■ 시간 설정 정보                                                                                         
echo.
w32tm /dumpreg /subkey:Parameters                                                                              
echo -------------------------------------------------------                                                   
echo  ■ NTP 서버와 시간차                                                                                      
echo.
echo  1) 192.168.1.100 서버                                                                                    
echo.
w32tm /stripchart /dataonly /computer:192.168.1.100 /samples:5                                                 
echo.
echo  2) time.windows.com 서버                                                                                 
echo.
w32tm /stripchart /dataonly /computer:time.windows.com /samples:5                                              
echo.

echo [ Checking 4/15 ]
echo ==========================================================================================================
echo  CPU, 메모리 사용률 확인                                                                                  
echo ========================================================================================================== 
echo  ■ Physical 메모리 정보                                                                                   
echo.
systeminfo | findstr "Memory" | find "Physical"                                                                
echo.
echo  ※ 20초 동안 CPU 사용률, 사용 가능한 메모리 점검은 script 폴더에 생성된 Result.csv 파일 참고          
typeperf "\Processor(_Total)\%% Processor time" "\Memory\Available MBytes" -y -sc 21 -o Result.csv
echo.

echo [ Checking 5/15 ]
echo ==========================================================================================================
echo  디스크 사용률 확인                                                                                       
echo ========================================================================================================== 
powershell "Get-WmiObject Win32_LogicalDisk"                                                                   
echo.

echo [ Checking 6/15 ]
echo ==========================================================================================================
echo  Array 상태 확인                                                                                          
echo ========================================================================================================== 
echo  ※ HP Smart Storage의 Logical/Physical Drive 상태 수동 점검                                              
echo.

echo [ Checking 7/15 ]
echo ==========================================================================================================
echo  기본 계정 활성 여부 확인(Administrator, Guest 계정)                                                      
echo ==========================================================================================================
echo  1) Administrator 계정                                                                                    
net user administrator | find "active"                                                                         
echo.
echo  2) Guest 계정                                                                                            
net user guest | find "active"                                                                                 
echo.

echo [ Checking 8/15 ]
echo ==========================================================================================================
echo  불필요한 계정 존재 여부 확인                                                                             
echo ========================================================================================================== 
FOR /F "tokens=1 skip=4" %%j IN ('net user') DO net user %%j                                                   
FOR /F "tokens=2 skip=4" %%j IN ('net user') DO net user %%j                                                   
FOR /F "tokens=3 skip=4" %%j IN ('net user') DO net user %%j                                                   
echo.

echo [ Checking 9/15 ]
echo ==========================================================================================================
echo  계정 잠금 임계값 확인                                                                                    
echo ==========================================================================================================
net accounts | find "Lockout threshold"                                                                        
echo.

echo [ Checking 10/15 ]
echo ==========================================================================================================
echo  관리자 그룹 계정 확인                                                                                    
echo ==========================================================================================================
net localgroup administrators                                                                                  
echo.

echo [ Checking 11/15 ]
echo ==========================================================================================================
echo  관리자 계정 암호 변경일 확인                                                                             
echo ==========================================================================================================
net user kpcadmin | find "last set"                                                                            
echo.

echo [ Checking 12/15 ]
echo ==========================================================================================================
echo  OS 방화벽 사용 여부 확인                                                                                 
echo ==========================================================================================================
netsh advfirewall show currentprofile                                                                          
echo.

echo [ Checking 13/15 ]
echo ==========================================================================================================
echo  기본 공유 설정 여부 확인                                                                                 
echo ==========================================================================================================
echo  1) 하드디스크 기본 공유 확인                                                                             
net share | FIND /V "IPC$" | FIND /V "command PRINT$ FAX$" | FIND "$" | findstr /I "^[A-Z]"                    
echo.
echo  2) 레지스트리 설정 확인                                                                                  
reg query "HKLM\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters\AutoShareServer"                     
reg query "HKLM\SYSTEM\CurrentControlSet\Services\lanmanserver\parameters\AutoShareWks"                        
echo.

echo [ Checking 14/15 ]
echo ==========================================================================================================
echo  실행중인 서비스 확인                                                                                     
echo ==========================================================================================================
net start | find /v "started" | find /v "completed"                                                            
echo.

echo ==========================================================================================================
echo  윈도우 업데이트 날짜                                                                                     
echo ==========================================================================================================
echo  ※ 최근 윈도우 업데이트 성공 일자 수동 점검                                                              
echo.

echo ==========================================================================================================
echo  백신 업데이트 날짜                                                                                       
echo ==========================================================================================================
echo  ※ 최근 백신 업데이트 성공 일자 수동 점검                                                                
echo.

echo ==========================================================================================================
echo  백업 유무                                                                                                
echo ==========================================================================================================
echo  ※ 백업 유무 수동 점검                                                                                   
echo.

echo ==========================================================================================================
echo  이벤트 로그                                                                                              
echo ==========================================================================================================
echo  ※ 이벤트 로그 수동 점검                                                                                
echo.

echo [ Checking 15/15 ]
echo ==========================================================================================================
echo  점검일자                                                                                                 
echo ==========================================================================================================
date /t                                                                                                        
echo.

cls
echo ========= KPC Windows System / Security Check is End =========
::pause